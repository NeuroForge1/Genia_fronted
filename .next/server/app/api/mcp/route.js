(()=>{var e={};e.id=90,e.ids=[90],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1997:e=>{"use strict";e.exports=require("punycode")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3348:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>l});var n=r(6559),i=r(8088),o=r(7719),a=r(2190),c=r(6621);class u{async analyzeIntent(e,t){try{let t=e.toLowerCase();if(t.includes("contenido")||t.includes("art\xedculo")||t.includes("blog")||t.includes("post")||t.includes("escribir"))return{primaryIntent:"content_creation",entities:{contentType:this.detectContentType(e)},confidence:.85};if(t.includes("anuncio")||t.includes("publicidad")||t.includes("campa\xf1a")||t.includes("ads")||t.includes("promocionar"))return{primaryIntent:"advertising",entities:{adPlatform:this.detectAdPlatform(e)},confidence:.82};if(t.includes("estrategia")||t.includes("negocio")||t.includes("empresa")||t.includes("crecimiento")||t.includes("plan"))return{primaryIntent:"business_strategy",entities:{},confidence:.78};if(t.includes("embudo")||t.includes("funnel")||t.includes("conversi\xf3n")||t.includes("leads")||t.includes("ventas"))return{primaryIntent:"funnel_optimization",entities:{},confidence:.8};return{primaryIntent:"general_query",entities:{},confidence:.6}}catch(e){return console.error("Error analyzing intent:",e),{primaryIntent:"error",entities:{},confidence:0}}}detectContentType(e){let t=e.toLowerCase();return t.includes("blog")||t.includes("art\xedculo")?"blog":t.includes("instagram")||t.includes("post")?"social_media":t.includes("email")||t.includes("correo")?"email":"general"}detectAdPlatform(e){let t=e.toLowerCase();return t.includes("facebook")||t.includes("meta")?"facebook":t.includes("google")||t.includes("adwords")?"google":t.includes("instagram")?"instagram":t.includes("linkedin")?"linkedin":"general"}determineClone(e){switch(e.primaryIntent){case"content_creation":return"content";case"advertising":return"ads";case"business_strategy":default:return"ceo";case"funnel_optimization":return"funnel";case"voice_communication":return"voice";case"time_management":return"calendar"}}async routeRequest(e,t){try{let r=await this.analyzeIntent(e,t),s=this.determineClone(r),n=await this.createTask(t,s,e);return{success:!0,selectedClone:s,taskId:n}}catch(e){return console.error("Error routing request:",e),{success:!1,error:e instanceof Error?e.message:"Error desconocido"}}}async createTask(e,t,r){try{let{data:s,error:n}=await c.ND.from("clones_history").insert([{user_id:e,clone_type:t,request:r,status:"pending",created_at:new Date().toISOString()}]).select("id");if(n)throw Error(`Error creating task: ${n.message}`);return s?.[0]?.id||""}catch(e){throw console.error("Error creating task:",e),e}}async executeTask(e){try{let{data:t,error:r}=await c.ND.from("clones_history").select("*").eq("id",e).single();if(r||!t)throw Error(`Error fetching task: ${r?.message||"Task not found"}`);return await c.ND.from("clones_history").update({status:"processing",updated_at:new Date().toISOString()}).eq("id",e),await c.ND.from("clones_history").update({status:"completed",updated_at:new Date().toISOString(),response:"Tarea completada exitosamente"}).eq("id",e),{id:t.id,userId:t.user_id,cloneType:t.clone_type,status:"completed",request:t.request,response:"Tarea completada exitosamente",createdAt:new Date(t.created_at),updatedAt:new Date}}catch(t){throw console.error("Error executing task:",t),await c.ND.from("clones_history").update({status:"failed",updated_at:new Date().toISOString(),response:t instanceof Error?t.message:"Error desconocido"}).eq("id",e),t}}async processMessage(e,t){try{let r=await this.routeRequest(e,t);if(!r.success||!r.taskId)return r;let s=await this.executeTask(r.taskId);return{success:!0,selectedClone:r.selectedClone,response:s.response,taskId:r.taskId}}catch(e){return console.error("Error processing message:",e),{success:!1,error:e instanceof Error?e.message:"Error desconocido"}}}}let d=new u;async function l(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return a.NextResponse.json({error:"No est\xe1s autenticado"},{status:401});let r=t.split(" ")[1],{data:{user:s},error:n}=await c.ND.auth.getUser(r);if(n||!s)return a.NextResponse.json({error:"Token inv\xe1lido o expirado"},{status:401});let{message:i,context:o}=await e.json();if(!i)return a.NextResponse.json({error:"El mensaje es requerido"},{status:400});let{data:u,error:l}=await c.ND.from("profiles").select("credits, plan").eq("user_id",s.id).single();if(l)return a.NextResponse.json({error:"Error al obtener el perfil del usuario"},{status:500});if(u.credits<=0&&"free"===u.plan)return a.NextResponse.json({error:"No tienes suficientes cr\xe9ditos para realizar esta acci\xf3n"},{status:402});let p=await d.processMessage(i,s.id);if(!p.success)return a.NextResponse.json({error:p.error||"Error al procesar el mensaje"},{status:500});return"free"===u.plan&&await c.ND.from("profiles").update({credits:u.credits-1}).eq("user_id",s.id),await c.ND.from("user_actions").insert([{user_id:s.id,action_type:"message_sent",details:{message:i,clone:p.selectedClone,task_id:p.taskId},created_at:new Date().toISOString()}]),a.NextResponse.json({success:!0,response:p.response,clone_type:p.selectedClone,task_id:p.taskId,credits_remaining:"free"===u.plan?u.credits-1:null})}catch(e){return console.error("Error in MCP endpoint:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Error desconocido"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/mcp/route",pathname:"/api/mcp",filename:"route",bundlePath:"app/api/mcp/route"},resolvedPagePath:"/home/ubuntu/genia/Genia_fronted/src/app/api/mcp/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:f,serverHooks:g}=p;function y(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:f})}},4075:e=>{"use strict";e.exports=require("zlib")},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},6487:()=>{},6621:(e,t,r)=>{"use strict";r.d(t,{ND:()=>s});let s=(0,r(6345).UU)("https://axfcmtrhsvmtzqqhxwul.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4ZmNtdHJoc3ZtdHpxcWh4d3VsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM4MjA2MzksImV4cCI6MjA1OTM5NjYzOX0.F7X3QI2AL90Q-XZjWceSuW45vDMBjz7txTqge4lwxtQ",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"genia-auth-token"}})},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,345],()=>r(3348));module.exports=s})();