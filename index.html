<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GENIA - Tu Sistema de Crecimiento con IA</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#67f8c0">
  <script src="config.js"></script>
  <script src="script.js"></script>
  <script src="pwa-register.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #0e0e0e;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 60px auto;
      padding: 30px;
      text-align: center;
      background: #1c1c1c;
      border-radius: 12px;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      color: #67f8c0;
    }
    p {
      font-size: 1rem;
      margin-bottom: 30px;
    }
    input, button {
      padding: 12px;
      margin: 10px;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    input {
      width: 80%;
    }
    button {
      background: #67f8c0;
      color: #000;
      cursor: pointer;
    }
    .error-message {
      color: #ff6b6b;
      margin-top: 10px;
      display: none;
    }
    .success-message {
      color: #67f8c0;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Activa tu GENIA gratis por 7 días</h1>
    <p>Tu sistema de crecimiento automatizado con IA. Sin riesgo. Sin esfuerzo.</p>

    <form id="register-form" class="register-form">
      <input type="text" name="nombre" placeholder="Tu nombre completo" required><br>
      <input type="email" name="email" placeholder="Tu correo electrónico" required><br>
      <input type="text" name="negocio" placeholder="¿Qué vendes? (opcional)"><br>
      <button type="submit">Probar ahora gratis</button>
      <div class="error-message" id="error-message"></div>
      <div class="success-message" id="success-message"></div>
    </form>

    <p style="margin-top: 20px; font-size: 0.9rem; color: #999;">
      No se te cobrará nada hoy. El cargo se realiza después del periodo de prueba. Puedes cancelar en cualquier momento.
    </p>
  </div>

  <!-- Scripts GENIA API Integration -->
  <script src="services/api_integration.js"></script>
  <script src="enhanced_script.js"></script>
  <script>
    // Funciones auxiliares para mostrar mensajes
    function showError(message) {
      const errorElement = document.getElementById('error-message');
      errorElement.textContent = message;
      errorElement.style.display = 'block';
      setTimeout(() => {
        errorElement.style.display = 'none';
      }, 5000);
    }

    function showSuccess(message) {
      const successElement = document.getElementById('success-message');
      successElement.textContent = message;
      successElement.style.display = 'block';
      setTimeout(() => {
        successElement.style.display = 'none';
      }, 5000);
    }

    // Asegurarse de que el formulario use la autenticación de Supabase
    document.addEventListener('DOMContentLoaded', function() {
      const registerForm = document.getElementById('register-form');
      
      registerForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const nombre = registerForm.querySelector('input[name="nombre"]').value;
        const email = registerForm.querySelector('input[name="email"]').value;
        const negocio = registerForm.querySelector('input[name="negocio"]').value;
        
        try {
          // Generar una contraseña aleatoria para el usuario
          const password = Math.random().toString(36).slice(-10) + Math.random().toString(36).slice(-10);
          
          // Registrar al usuario usando la API de autenticación
          const userData = {
            email: email,
            password: password,
            name: nombre,
            business_type: negocio
          };
          
          const result = await geniaApi.auth.register(userData);
          
          if (result.success) {
            showSuccess('Registro exitoso. Redirigiendo al dashboard...');
            setTimeout(() => {
              window.location.href = '/dashboard.html';
            }, 2000);
          } else {
            showError('Error de registro: ' + (result.message || 'Intente nuevamente'));
          }
        } catch (error) {
          console.error('Error al registrar:', error);
          showError('Error al registrar: ' + (error.message || 'Intente nuevamente'));
        }
      });
    });
  </script>
</body>
</html>
